package example;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

import com.google.gson.Gson;

import exModule.Module1;

// 모듈화 하기
class Data {
	
	private String info;
	
	public String getInfo() {
		
		try {
			// 1번 주소 객체 만들기
			URL url = new URL("https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/sales/json?page=1");

			// 2번 스트림 연결
			HttpURLConnection con = (HttpURLConnection) url.openConnection();

			// 3번 버퍼 연결 (문자열)
			BufferedReader br = new BufferedReader(new InputStreamReader(con.getInputStream(), "UTF-8"));

			// 4. 문자 더하기
			StringBuilder sb = new StringBuilder();

			// 스트링빌더에 버퍼에서 받은 문자열을 한줄씩 추가하기
			String input = "";
			while ((input = br.readLine()) != null) {
				sb.append(input);
			}
			
			// 입력이 잘 되었는지 테스트
			System.out.println(sb.toString());
			System.out.println();

			br.close(); // 버퍼 닫기
			con.disconnect(); // 스트림 닫기

			// 5. 자바 오브젝트로 변환
			Gson gson = new Gson();
			Module1 info = gson.fromJson(sb.toString(), Module1.class);

			return info.getStoreInfos().get(0).getName();
			
		} catch (Exception e) {
			e.printStackTrace();
		}

		return null;

	}

}

// main에서는 모듈에서 가공한 정보를 가져와서 쓰기만 하면된다
public class Data1 {

	public static void main(String[] args) {
		
		System.out.println(new Data().getInfo());

	}
}



